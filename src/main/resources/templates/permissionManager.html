<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="it">
<head>
<meta charset="ISO-8859-1">
<title>Permission manager</title>
<script
	src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<link
	href="https://fonts.googleapis.com/css?family=Lato:300,400,700&display=swap"
	rel="stylesheet">

<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

</head>
<script>
function sendAjaxRequest() {
    var email = $("#email").val();
    $.get( "http://localhost:8080/profile/getPermessiMancanti?email=" + email, function( data ) {
        $("#permessiMancanti").empty();
        var option1 = "<option value = " + 0 + "> Seleziona un utente per modificare i permessi </option>";
        $("#permessiMancanti").append(option1);
        data.forEach(function(item, i) {
            var option2 = "<option value = " + item + ">" + item +  "</option>";
            $("#permessiMancanti").append(option2);
        });
    });
    
    $.get( "http://localhost:8080/profile/getAllPermessi?email=" + email, function( data ) {
        $("#TuttiPermessi").empty();
        var option1 = "<option value = " + 0 + "> Seleziona un permesso da rimuovere </option>";
        $("#TuttiPermessi").append(option1);
        data.forEach(function(item, i) {
            var option2 = "<option value = " + item + ">" + item +  "</option>";
            $("#TuttiPermessi").append(option2);
        });
    });
    
};

$(document).ready(function() {
    $("#email").change(function() {
        sendAjaxRequest();
    });
});
</script>
<body> <!--  onload="loadUse(); loadDoc();" -->

	<div><!-- 
		<h2>Permessi Utente:</h2>
		<table>
			<tr>	
				<td th:each="permesso : ${permessiUtente}">
					<p th:text="${permesso}"></p>
				</td>
			</tr>
		</table>
		 -->
		<p>Seleziona un utente</p>
		<form th:action="@{/profile/addPermesso(email = ${email} , flag = ${flag})}" method="post">
			<select id="email" th:value="${email}" th:name="email">
				<option value="0">Seleziona un utente per modificare i permessi</option>
				<option th:each="utente : ${utenti}" th:value="${utente}" th:text="${utente}"></option>
			</select>
		
		<!--  </form>-->
		  
			<p>Aggiungi un permesso</p>
			<select id="permessiMancanti" th:name="pAdd">
				<option value="0">seleziona un permesso da aggiungere</option>
					<!-- <option th:each="p : ${permessiMancanti}" th:value="${p}" th:text="${p}"></option> -->
			</select>
			<button type="submit" th:name="flag" th:value="1">Invia</button>
		<!--  </form> -->
			<p>Rimuovi un permesso</p>
		<!--  <form th:action="@{/profile/removePermesso(email = ${email})}" method="post">-->
			<select id="TuttiPermessi" th:name="pRemove">
				<option value="0">Seleziona un permesso da rimuovere</option>
				<!--  <option th:each="pRemove : ${permessiUtente}"  th:value="${pRemove}" th:text="${pRemove}"></option> -->
			</select>
			<button type="submit" th:name="flag" value="0">Invia</button>
		</form>
		
	</div>
</body>
</html>




<!-- 
	<p>User</p>
	<div id="demo1"></div>
	<div style="text-align: center;">
		Permessi:
		<form method="POST">
    		<select id="Select" onclick="formSubmit()">
			</select>	
		</form>
		<p id="resulted"></p>
	
</div>

	<script type="text/javascript">
	
		
		function loadUse() {
			const xhttp = new XMLHttpRequest();
			xhttp.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {

					var risposta = this.responseText;
					
					var obj = JSON.parse(risposta);
					
					//var obj2 = { "permessi": ["X"] }; 
					//obj.push(obj2);
					
					document.getElementById("demo1").innerHTML = "<strong>"
							+ obj.nome + "</strong>&nbsp;&nbsp;&nbsp;&nbsp;"
							+ obj.permessi;

				}

			};
			xhttp.open("GET", "/view/permissionManager/user.json", true);
			xhttp.send();
		}

		function loadDoc() {
			const xhttp = new XMLHttpRequest();
			xhttp.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {
					var risposta = this.responseText;
					var obj = JSON.parse(risposta)
					for (var i = 0; i < obj.length; i++) {
						var select = document.getElementById("Select");
						var option = document.createElement("option");
						option.text = obj[i].nome + " " + obj[i].descrizione ;
						option.value = obj[i].nome;
						select.add(option);
						
					}
				}
			};
			xhttp.open("GET", "/view/permissionManager/data.json", true);
			xhttp.send();
		}
		
		function formSubmit(){
			  var x = document.getElementById("Select").value;
			  document.getElementById("resulted").innerHTML = "Hai selezionato '" + x +"'";
		}
		
		
	</script> -->

