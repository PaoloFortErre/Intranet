<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="it" dir="ltr">
<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <title>Profilo Intranet</title>
  <meta name="description" content="Questo è un profilo admin">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Add text library -->
  <link href='https://fonts.googleapis.com/css?family=Montserrat'
  rel='stylesheet' type='text/css'>
  <!-- Add icon library -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
  integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l"
  crossorigin="anonymous">

  <!-- Option 1: jQuery and Bootstrap Bundle (includes Popper) -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
  integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
  crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns"
  crossorigin="anonymous"></script>

  <style media="screen">

  body {
    background-color: black;
    background-image: url("/view/Profile/Images/bg-profile.jpg");
    background-repeat: no-repeat;
    background-size: cover,contain;
    color:#F3F3F3;
    font-family: 'Montserrat', sans-serif;
    font-weight: 400;
    overflow-x: hidden;
  }

  .nav-link:hover {
	   color: #ECF260;
  }
  nav {
  	font-size: 20px;
  	color: #F3F3F3;
    width: 100%

  }

  .casa:hover {
    opacity: 0.8 !important;
  }

  .content>a {
    color: #F3F3F3;
  }

  .content>a:link {
    text-decoration: none;
  }

  .content>a:hover {
    color: blue;
  }

  /* Top left pin */
  .top-left {
    position: absolute;
    width: 35;
    height: 70px;
    top: 2px;
    left: -20px;
  }

  /*Profile Pic Start*/
  .picture{
    width: 270px;
    height: 270px;
    background-color: #999999;
    border: 3px solid #CCCCCC;
    color: #FFFFFF;
    border-radius: 50%;
    overflow: hidden;
    transition: all 0.2s;
    -webkit-transition: all 0.2s;
  }
  .profile_pic{
    position: relative;
    text-align: center;
  }
  .bottom-right{
    position: absolute;
    bottom: 8px;
    right: 16px;
  }

  .picture:hover{
    border-color: yellow;
  }

  #myImg {
    border-radius: 5px;
    cursor: pointer;
    transition: 0.3s;
  }

  #myImg:hover {opacity: 0.7;}

  /* The Modal (background) */
  .modal {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1; /* Sit on top */
    padding-top: 100px; /* Location of the box */
    left: 0;
    top: 0;
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgb(0,0,0); /* Fallback color */
    background-color: rgba(0,0,0,0.9); /* Black w/ opacity */
  }

  /* Modal Content (image) */
  .modal-content {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
  }

  /* Caption of Modal Image */
  #caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    height: 150px;
  }

  /* Add Animation */
  .modal-content, #caption {
    -webkit-animation-name: zoom;
    -webkit-animation-duration: 0.6s;
    animation-name: zoom;
    animation-duration: 0.6s;
  }

  @-webkit-keyframes zoom {
    from {-webkit-transform:scale(0)}
    to {-webkit-transform:scale(1)}
  }

  @keyframes zoom {
    from {transform:scale(0)}
    to {transform:scale(1)}
  }

  /* The Close Button */
  .close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    transition: 0.3s;
  }

  .close:hover,
  .close:focus {
    color: #bbb;
    text-decoration: none;
    cursor: pointer;
  }

  /* 100% Image Width on Smaller Screens */
  @media only screen and (max-width: 700px){
    .modal-content {
      width: 100%;
    }
  }
  /*Profile Pic End*/

  .input--file {
    position: relative;
    color: #7f7f7f;
  }

  .input--file input[type="file"] {
    position: absolute;
    top: 0;
    left: 0;
    opacity: 0;
    cursor: pointer;
  }
  /* Darker background on mouse-over */
  .camera:hover {
    color: yellow;
  }

  .card-text{
    font-size: 13px;
  }
  #immagine{
    display: none;
  }
  .scegli_immagine{
    cursor: pointer;
  }

  /*START FOOTER*/
  footer {
    margin-top:150px;
    background-color: black;
    width: 100%;
    height: 160px;
    flex-shrink: 0;
  }

  /* Style all font awesome icons */
  footer .fa {
    padding: 20px;
    font-size: 30px;
    width: 70px;
    height: 70px;
    text-align: center;
    text-decoration: none;
  }

  /* Add a hover effect if you want */
  footer .fa:hover {
    opacity: 0.8;
  }

  /* Set a specific color for each brand */

  /* Facebook */
  .fa-facebook {
    background: #3B5998;
    color: white;
  }

  /* Twitter */
  .fa-linkedin {
    background: #55ACEE;
    color: white;
  }

  </style>

</head>

<body>

  <!--NAVBAR CON LINK A PAGINE E LINK A SITO ERRE-->
  <div class="row">
    <nav
  		class="navbar navbar-expand-md bg-dark navbar-dark justify-content-end">
  		<a class="navbar-brand" th:href="@{/homepage/}"><img
  			src="/view/MyWork/images/casabianca.png" width="30px"
  			alt="homeBianca.png" style="opacity: 0.9" class="img-fluid ml-3"></a>
  		<button class="navbar-toggler" type="button" data-toggle="collapse"
  			data-target="#collapsibleNavbar">
  			<span class="navbar-toggler-icon"></span>
  		</button>
  		<div class="collapse navbar-collapse justify-content-end"
  			id="collapsibleNavbar">
  			<ul class="navbar-nav ml-5 mr-5">
          <li class="nav-item mr-3 mt-3"><a class="nav-link"
  					th:href="@{/myWork/}">MY WORK</a></li>
  				<li class="nav-item mr-3 mt-3"><a class="nav-link"
  					th:href="@{/myLife/}">MY LIFE</a></li>
  				<li class="nav-item mr-3 mt-3"><a class="nav-link"
  					th:href="@{/comunicazioniHr/}">COMUNICAZIONI HR</a></li>
  				<li class="nav-item mr-3 mt-3"><a class="nav-link"
  					th:href="@{/moduli/}">MODULI</a></li>
  				<li class="nav-item mr-3 mt-3"><a class="nav-link"
  					href="http://polyedro.erretechnology.com/www/" target="blank">POLYEDRO</a>
  				</li>

  			</ul>
  		</div>
  	</nav>


      </div>

      <!-- ROW CON IMMAGINE PROFILO, NOME, COGNOME, EMAIL  -->

      <div class="container mt-4">
        <div class="row justify-content-start align-items-center">

          <!-- IMMAGINE PROFILO -->
          <div class="col-xl-3 col-lg-3 col-md-4 col-sm-4 col-xs-5">
            <div class="profile_pic">
              <img id="myImg" class="picture rounded-circle"
              th:src="'data:image/png;base64,' + ${utente.immagine.getImgData(utente.immagine.data)}" alt="profile_picca">

              <!-- The Modal -->
              <div id="myModal" class="modal">
                <span class="close">&times;</span>
                <img class="modal-content" id="img01">
                <div id="caption"></div>
              </div>
              <script>
              // Get the modal
              var modal = document.getElementById("myModal");

              // Get the image and insert it inside the modal - use its "alt" text as a caption
              var img = document.getElementById("myImg");
              var modalImg = document.getElementById("img01");
              var captionText = document.getElementById("caption");
              img.onclick = function(){
                modal.style.display = "block";
                modalImg.src = this.src;
                captionText.innerHTML = this.alt;
              }

              // Get the <span> element that closes the modal
              var span = document.getElementsByClassName("close")[0];

              // When the user clicks on <span> (x), close the modal
              span.onclick = function() {
                modal.style.display = "none";
              }
              </script>

              <div class="  bottom-right" th:if="${session.id} == ${utente.utente.id}">
                <a class="dropdown fa fa-camera text-white" href="#" id="imageDropdown" title="Clicca per gestire la foto profilo" data-toggle="dropdown">
                </a>
                    <ul class="dropdown-menu" role="menu" aria-labelledby="imageDropdown" >
                      <form th:action="@{/profile/cambiaFotoProfilo}" method ="post" enctype="multipart/form-data">
                        <label class="dropdown-item " style="cursor: pointer;" for="scegli">Modifica la foto profilo</label>
                        <input class="d-none" type="file" name="immagine" id="scegli" accept="image/png, image/jpeg"/>
                        <label class="dropdown-item" style="cursor: pointer;" for="salva">Salva la foto profilo</label>
                        <input class="d-none" type="submit" id="salva"/>
                        <div class="dropdown-divider"></div>
                      </form>
                      <form th:action="@{/profile/eliminaFotoProfilo}" method ="post">
                        <label class="dropdown-item font-weight-bold text-danger" style="cursor: pointer;" for="elimina">Elimina la foto profilo</label>
                        <input class="d-none" type="submit" value="Elimina foto profilo" id="elimina">
                      </form>
                  </ul> 
              </div>

            </div>


            <!-- IMPOSTAZIONI PROFILO -->
            <div class="dropdown mt-3 text-justify ml-4" th:if="${session.id} == ${utente.utente.id}">
              <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Impostazioni profilo
              </button>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <form th:action="@{/profile/setVisualizzazione}" method ="post">
                  <div class="form-check pr-1 font-weight-bold">
                    Vuoi condividere la tua data di nascita?<br>
                    <input type="radio" style="cursor: pointer;" id="set" name="set" value="Si" th:checked="${utente.visualizzaDataNascita}">
                    <label for="set"><b>SI</b></label>
                    <input type="radio" style="cursor: pointer;" id="set" name="set" value="No" th:checked="${!utente.visualizzaDataNascita}">
                    <label for="set" ><b>NO</b></label><br>
                    <input class="btn btn-info" type="submit" value="Cambia!">
                  </div>
                </form>
                <div class="dropdown-divider bg-primary"></div>
                <a class="dropdown-item mt-1" th:href="@{/profile/cambioPassword}" method="post"><b>Cambio password</b></a>
                <div class="dropdown-divider bg-primary"></div>
                <a class="dropdown-item mt-1" th:href="@{/logout}"><b>Logout</b></a>
              </div>
            </div>
            <!-- GESTIONE SUPREMA -->
            <div class="ml-4" th:if="${admin}">
              <a class="btn btn-primary mt-3" th:href="@{/profile/mostraEliminati}" method="get">Gestione per admin</a>
            </div>
          </div>

          <!-- ANAGRAFICA PROFILO -->
          <div class="col-xl-4 col-lg-4 col-md-5 col-sm-10 col-xs-auto mt-3">
            <div class="container text-center">
              <h1 class="h1" th:text="${utente.nome}" style="font-weight: 600"></h1>
              <h1 class="h1 text-primary" th:text="${utente.cognome}" style="font-weight: 600"></h1><br>
              <a class="h6" th:href="'mailto:' + ${utente.utente.email}"  ><h6 th:text="${utente.utente.email}" style="color:#F3F3F3;"></h6></a><br>

              <!--LOGO DINAMICO -->
              <div class="container">
                <img class="shadow " style="width: 150px;"
                th:src="'data:image/png;base64,' + ${utente.settore.getImgData(utente.settore.logo)}" alt="logo-agency">
              </div>

            </div>
          </div>

          <!-- SOLO PER ADMIN NUMERO UTENTI E GESTIONE -->
          <div class="col-auto" th:if="${session.id} == ${utente.utente.id}" th:with="AM = ${#authorization.expression('hasAuthority(''AM'')')}">
            <div class="container shadow text-center rounded pr-n2 pl-n2" th:if="${AM}" style="position: relative; background-color: #f8f9fa">
              <img class="top-left" src="/view/Profile/Images/pin_post-it.png" alt="pin-post-it">
              <div class="container text-white mt-5 pt-3">
                <h1 class="h1 text-center mt-3 text-dark" th:text="${attivi}" style="font-weight: 800 !important">"</h1>
                <h3 class="h3" style="color:#303030; ">UTENTI REGISTRATI</h3>
              </div><br>
              <!-- GESTIONE ACCOUNT INTRANET -->
              <div class="container">
                <div class="btn-group mb-4">
                  <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Gestisci gli utenti
                  </button>
                  <div class="dropdown-menu">
                    <a class="dropdown-item font-weight-bold" th:href="@{/profile/registra}">AGGIUNGI O RIATTIVA UTENTE</a>
                    <a class="dropdown-item text-danger font-weight-bold mt-2" th:href="@{/profile/cancellaUtente}">ELIMINA UTENTE</a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item font-weight-bold" th:href="@{/profile/gestisciPermesso}">GESTISCI I PERMESSI DEGLI UTENTI</a>
                  </div>
                </div>
              </div>


            </div>
          </div>

        </div>
      </div>




      <!-- ROW DESCRIZIONE PERSONALE -->
      <div class="container mt-5">
        <div class="row justify-content-center">

          <div class="col-xl-9 col-lg-8 col-md-10 col-sm-10 col-xs-10">
            <div class="card position-relative text-end">
              <img class="top-left" src="/view/Profile/Images/pin_post-it.png" alt="pin-post-it">
              <div class="card-body">
                <h3 class="h3 card-title text-center" style="color:#303030">Una breve descrizione di me stesso</h3>
                <p class="h4 card-text" th:text="${utente.descrizione}" style="color:#303030"></p>
                <div th:if="${session.id} == ${utente.utente.id}">
                  <form th:action="@{/profile/modificaDescrizione}" method="post">
                    <div class="form-group">
                      <textarea class="form-control" id="exampleFormControlTextarea1" name="descrizione" placeholder="Modifica la tua descrizione"
                      cols="35" rows="3" maxlength="499" required style="resize: none"></textarea>
                    </div>
                    <div class="text-center">
                      <input class="btn btn-primary " type="submit" value="Modifica descrizione"/>
                    </div>

                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ROW FOTO PERSONALI -->
      <div class="container mt-5">
        <div class="row justify-content-center">

          <div class="col-xl-9 col-lg-8 col-md-10 col-sm-10 col-xs-10">

            <div class="container position-relative">
              <img class="top-left position-absolute" src="/view/Profile/Images/pin_post-it.png" alt="pin-post-it">
              <div id="carouselExampleCaptions" class="carousel slide" data-ride="carousel">
                <ol class="carousel-indicators">
                  <li data-target="#carouselExampleCaptions" data-slide-to="0" class="active"></li>
                  <li data-target="#carouselExampleCaptions" data-slide-to="1"></li>
                </ol>
                <div class="carousel-inner">

                  <div class="carousel-item active th:if="${session.id} == ${utente.utente.id}"">
                    <img src="/view/Login/images/Homepage/my_life_2.jpg" class="d-block w-100 h-100" alt="...">
                    <div class="carousel-caption d-none d-md-block">
                      <h5>First slide label</h5>
                      <p>Some representative placeholder content for the first slide.</p>
                    </div>
                  </div>
                  <div class="carousel-item">
                    <img src="/view/Login/images/Homepage/my_life_3.jpg" class="d-block w-100 h-100" alt="...">
                    <div class="carousel-caption d-none d-md-block">
                      <h5>Second slide label</h5>
                      <p>Some representative placeholder content for the second slide.</p>
                    </div>
                  </div>
                </div>
                <a class="carousel-control-prev"
                href="#carouselExampleCaptions" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
              </a>
              <a class="carousel-control-next" href="#carouselExampleCaptions" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
              </a>
            </div>
          </div>

        </div>
      </div>
    </div>



    <!-- ROW DESCRIZIONE E DASHBOARD -->
    <div class="container mt-5">
      <div class="row justify-content-center mt-5 " th:with="AM = ${#authorization.expression('hasAuthority(''AM'')')}">
        <div class="col-xl-9 col-lg-8 col-md-10 col-sm-10 col-xs-10" th:if="${session.id} == ${utente.utente.id}">
          <div class="container bg-gradient-warning">

            <div class="card border border border-danger shadow text-center " style="color:#303030; border: 5px !important; position: relative" >
              <img class="img-fluid top-left" src="/view/Profile/Images/pin_post-it.png" alt="pin-post-it">
              <div class="card-header">
                <h5 class="h5"><b>ATTIVITA' RECENTI</b></h5>
                <small>Anteprima di quello che hai fatto di recente</small>
              </div>
              <div class="container-fluid">
                <table class="table table-dark">
                  <thead class="thead-light">
                    <tr>
                      <th scope="col" style="font-size: 17px "><b>Data e Ora</b></th>
                      <th scope="col" style="font-size: 17px "><b>Attività</b></th>
                    </tr>
                  </thead>
                  <tbody th:each="log:${log}">
                    <tr th:if="${AM}">
                      <td th:utext="${#dates.format(log.timestamp*1000, 'dd/MM/yyyy, HH:mm')}"></td>
                      <td th:utext="${log.utente.nome} + ' '+ ${log.utente.cognome} + ' ' + 'ha' + ' ' + ${log.azione}"></td>
                    </tr>
                    <tr th:if="${!AM}">
                      <td th:utext="${#dates.format(log.timestamp*1000, 'dd/MM/yyyy, HH:mm')}"></td>
                      <td th:utext="'hai' + ' ' + ${log.azione}"></td>
                    </tr>
                  </tbody>
                </table>
                <div class="container text-center">
                  <form th:action="@{/profile/mostra_log}" method="get">
                    <button type="submit" class="btn btn-primary mb-1">Vedi tutte</button>
                  </form>
                </div>
              </div>
            </div>
          </div>

        </div>



      </div>
    </div>

  </body>
  </html>
